{% extends "base.html" %}
{% block title %}Editar atleta | Sistema - Club de Tiro con Arco IPN{% endblock %}

{% block content %}
  <h1>Editar atleta</h1>

  <form method="post">

    <h2>Datos del miembro</h2>

    <div style="margin-bottom:10px;">
      <label>Nombre *</label><br/>
      <input name="nombre" required value="{{ miembro.nombre or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Apellido paterno</label><br/>
      <input name="apellido_paterno" value="{{ miembro.apellido_paterno or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Apellido materno</label><br/>
      <input name="apellido_materno" value="{{ miembro.apellido_materno or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>CURP</label><br/>
      <input value="{{ miembro.curp }}" disabled>
      <small style="display:block; opacity:.7;">CURP no editable.</small>
    </div>

    <div style="margin-bottom:10px;">
      <label>Correo</label><br/>
      <input name="correo" value="{{ miembro.correo or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Celular</label><br/>
      <input name="celular" value="{{ miembro.celular or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Edad</label><br/>
      <input name="edad" type="number" min="8" max="90" value="{{ miembro.edad or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Alergias</label><br/>
      <textarea name="alergias" rows="3">{{ miembro.alergias or '' }}</textarea>
    </div>

    <h2>Datos del atleta</h2>

    <div style="margin-bottom:10px;">
      <label>Â¿Alumno IPN?</label>
      <input name="alumno_ipn" type="checkbox" {% if atleta.alumno_ipn %}checked{% endif %}>
    </div>

    <div style="margin-bottom:10px;">
      <label>Boleta</label><br/>
      <input name="boleta" value="{{ atleta.boleta or '' }}">
    </div>

    <div style="margin-bottom:10px;">
      <label>Nivel *</label><br/>
      <select name="nivel" id="nivel" required style="max-width:240px;">
        <option value="Inicial" {% if atleta.nivel=='Inicial' %}selected{% endif %}>Inicial</option>
        <option value="Intermedio" {% if atleta.nivel=='Intermedio' %}selected{% endif %}>Intermedio</option>
        <option value="Avanzado" {% if atleta.nivel=='Avanzado' %}selected{% endif %}>Avanzado</option>
      </select>
    </div>

    <div style="margin-bottom:10px;">
      <label>Clase *</label><br/>
      <select name="clase_id" id="clase_id" required style="max-width:460px;">
        <option value="">Cargando...</option>
      </select>
    </div>

    <div class="actions">
      <button class="btn primary" type="submit">Guardar</button>
      <a class="btn" href="{{ url_for('list_atletas') }}">Cancelar</a>
    </div>
  </form>

  <script>
    async function cargarClases() {
      const nivel = document.getElementById("nivel").value;
      const sel = document.getElementById("clase_id");
      sel.innerHTML = `<option value="">Cargando...</option>`;

      try {
        const r = await fetch(`/api/clases?nivel=${encodeURIComponent(nivel)}`);
        const data = await r.json();

        if (!data.ok) {
          sel.innerHTML = `<option value="">No se pudieron cargar clases</option>`;
          return;
        }

        if (data.items.length === 0) {
          sel.innerHTML = `<option value="">No hay clases para ese nivel</option>`;
          return;
        }

        sel.innerHTML = `<option value="">-- Selecciona --</option>`;
        for (const it of data.items) {
          const opt = document.createElement("option");
          opt.value = it.clase_id;
          opt.textContent = it.label;
          sel.appendChild(opt);
        }

        sel.value = "{{ atleta.clase_id }}";
      } catch (e) {
        sel.innerHTML = `<option value="">Error cargando clases</option>`;
      }
    }

    document.getElementById("nivel").addEventListener("change", cargarClases);
    window.addEventListener("DOMContentLoaded", cargarClases);
  </script>
{% endblock %}
